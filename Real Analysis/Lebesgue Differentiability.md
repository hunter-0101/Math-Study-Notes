**Motivation**: given $F(x)=\int_{-\infty}^xf(t)dt$, notice that its difference formula $$\frac{F(x+h)-F(x)}{h}=\frac{1}{|I|}\int_If(t)dt\quad\text{where}\quad I=(x,x+h)$$We might expect that (under some conditions) the average tends to $f(x)$ as $h\to0$. This questions, together with the goal to generalize the fundamental theorem of calculus ([[Riemann Integral]]), motivates the following investigations, as well as the more general .

Below we're mainly considering what conditions are needed for functions to be differentiable $\ae$ and further verifies the FTC. All results relies on a simple and intuitive observation: given monotonicity the behavior of the function is overall "good enough" to give rise to FTC.

---
## Lebesgue differentiation theorem
**Theorem**: for $f\in L_{\text{loc}}^1(\mathbb R^d)$ we have the equality $$\lim_{\lambda(B)\to0,x\in B}\frac{1}{|B|}\int_Bf(t)dt=f(x),\quad\ae\ x\in\mathbb R^n$$We refer to these $x$ as **Lebesgue point**. 
**Proof**: we only need to proof that the following set is of measure zero for all $\alpha>0$: $$E_\alpha=\Set{x\in\mathbb R^n:\limsup_{B\to x}\frac{1}{|B|}\left|\int_B(f(t)-f(x))dt\right|>2\alpha}$$Since for any $\varepsilon>0$ we can find continuous compactly-supported $g$ such that $\|f-g\|_1<\varepsilon$ (by its density in $L^1$ [[Lp Space]]), we consider the decomposition $$\frac{1}{|B|}\int_Bf(t)dt-f(x)=\left(\frac{1}{|B|}\int_B(f(t)-g(t))dt\right)+\left(\frac{1}{|B|}\int_Bg(t)dt-g(x)\right)+(g(x)-f(x))$$the second term vanishes for $B\to x$ by continuity, and for any $x\in E_\alpha$ at least one of the two other terms should have absolute value at least $\alpha$. However by Hardy-Littlewood theorem $$\lambda(\set{x:(f-g)^*>\alpha})\le\frac{C}{\alpha}\|f-g\|_1<\frac{C}{\alpha}\varepsilon$$while by Chebyshev's inequality ([[Lp Space]]) $$\lambda(\set{x:|f(x)-g(x)|>\alpha})\le\frac{1}{\alpha}\|f-g\|_1<\frac{\varepsilon}{\alpha}$$thus $|E_\alpha|\le\frac{C+1}{\alpha}\varepsilon$. Taking $\varepsilon\to0$ would yield the result.
- **Intuition**: being a generalization of FTC to Lebesgue measure theory, LDT basically says that local integrability is strong enough to ensure differentiability.
- **Lebesgue density**: given $E$ measurable, $x\in E$ is a point of Lebesgue density if $$\lim_{\lambda(B)\to0,x\in B}\frac{\lambda(B\cap E)}{\lambda(B)}=1$$The above theorem, applied to $\chi_E$, shows that $\ae x\in E$ is a point of density of $E$, while $\ae x\notin E$ is not a point of density of $E$. [[Lebesgue Measure]]
- **Lebesgue set**: given $f\in L^1_{loc}$, its Lebesgue set consists of all points $x$ s.t. $f(x)<\infty$ and $$\lim_{\lambda(B)\to0,x\in B}\frac{1}{|B|}\int_B|f(t)-f(x)|dt=0$$apply the above theorem to $|f(t)-r|$ for all $r\in\mathbb Q$ and use triangle inequality (or repeat the proof with $(f-g)^*$ replaced by $|f-g|^*$) we know that $\ae\ x$ is in Lebesgue set.
	- **Why we care about Lebesgue set**: property owned by points in Lebesgue set is useful in many cases, say, the approximation to the identity. [[Convolution]].
- **Bounded eccentricity**: like [[Lebesgue Measure]], the differentiation theorem generalize to any such sets by an obvious upper bound.
## Differentiability
- **Function of bounded variation**: the total variation function of $f$ is defined as $$T_f(x)=\sup_\mathcal P\sum_{i=0}^{n_P-1}|f(x_{i+1})-f(x_i)|\quad\text{where }\quad\mathcal P=\set{P=\set{x_0,\cdots,x_{n_P}}\text{ a partition of }(-\infty,x]}$$If $T_f(\infty)<\infty$ we say that $f$ is of **bounded variation**. The set of such function is denoted $\bv$. For a finite interval $[a,b]$, the set of functions with $T_f(b)-T_f(a)<\infty$ is denoted as $\bv([a,b])$.
	- **Continuity**: continuity of $f$ implies continuity of $T_f$. To see this, let $f$ be continuous at $x_0$, then given $b>x_0$ there exists a partition $x_i$ of $[b,x_0]$ s.t. $$T_f(x_0,b)\le\sum_{i=0}^n|f(x_{i+1})-f(x_i)|+\varepsilon$$Take another $x_0<x<x_1$ close enough s.t. $f(x)-f(x_0)<\varepsilon$, then $$\begin{align}T_f(x_0,b)&\le|f(x_1)-f(x_0)|+\sum_{i=1}^n|f(x_{i+1})-f(x_i)|+\varepsilon\\&\le|f(x_1)-f(x)|+\sum_{i=1}^n|f(x_{i+1})-f(x_i)|+2\varepsilon\\&\le T_f(x,b)+2\varepsilon\end{align}$$which implies $T_f(x_0,x)<2\varepsilon$, hence $T_f$ is continuous at $x_0$.
	- **Positive/Negative variation**: define two non-decreasing functions $$P_f(a,x)=\sup_{(a,x)}\sum_{(+)}(f(x_{i+1})-f(x_i)),\quad N_f(a,x)=\sup_{(a,x)}\sum_{(-)}-(f(x_{i+1})-f(x_i))$$where the summation are over $f(x_{i+1})\ge/\le f(x_i)$. It's easy to show that $$f(x)-f(a)=P_f(a,x)-N_f(a,x),\quad T_f(a,x)=P_f(a,x)+N_f(a,x)$$by operations on partition. Further we have the **Jordan decomposition**: $$f=P_f-N_f=\frac{1}{2}(T_f+f)-\frac{1}{2}(T_f-f)$$Notice that $f\in\bv([a,b])$ iff it's the difference of two increasing bounded functions.
		- **Domain of strict increase**: ruling out the domain on which $f$ stays constant, it's obvious from the definition that the domain of strict increasing for $P_f$ is exactly that on which $N_f$ is constant, and vis versa.
	- **Number of discontinuities**: by the Jordan decomposition it's obvious that $f\in\bv$ has at most countably many discontinuities. Essentially, this is because such $f$ can only have jump discontinuities (one-sided limit exists, otherwise contradicting $\bv$), and uncountably many such discontinuities will make the summation diverge ([[Set Theory]]).
	- Relation with [[Measure]]: 
- **Differentiability of BV**: continuous $F\in \bv([a,b])$ is differentiable almost everywhere.
  **Proof**: by Jordan decomposition it suffices to consider $F$ increasing and bounded. Consider the Dini numbers $D^+,D^-,D_+,D_-$ ([[Differential Calculus on Euclidean Space]]), we only need to show $D^+<\infty\ae x$ and $D^+\le D_-\ae x$ for all $F\in \bv$, since the second inequality applied to $F(x),-F(-x)$ yields equality between four values. 
  1. $D^+<\infty\ae$: take $\gamma>0$, then $E_\gamma=\set{x:D^+>\gamma}$ is measurable since $D^+$ is measurable as a limit supremum, and apply the lemma below to $F(x)-\gamma x$ we get $E_\gamma\subset\bigcup(a_k,b_k)$ with $F(b_k)-F(a_k)\ge\gamma(b_k-a_k)$, hence $$\lambda(E_\gamma)\le\sum_k\lambda((a_k,b_k))\le\frac{1}{\gamma}\sum(F(b_k)-F(a_k))\le\frac{1}{\gamma}(F(b)-F(a))$$therefore $\lambda(E_\gamma)\to0$ as $\gamma\to\infty$.
  2. $D^+\le D_-$: fixing $R>r>0$ and let $E=\set{x:D^+>R>r>D_-}$. Assume that $\lambda(E)>0$, then there exists open $O$ s.t. $E\subset O\subset[a,b],\lambda(O)<\lambda(E)\cdot R/r$. Now $O=\bigcup I_n$ where $I_n$ open intervals, and for each $n$ the lemma below applied to $-F(-x)+rx$ on $I_n$ yields $\bigcup_k(a_k,b_k)\subset I_n$ with $F(b_k)-F(a_k)\le r(b_k-a_k)$. On each $(a_k,b_k)$ we again apply the lemma to $F(x)-Rx$ to get $\bigcup_j(a_{k,j},b_{k,j})\subset(a_k,b_k)$ with $F(b_{k,j})-F(a_{k,j})\ge R(b_{k,j}-a_{k,j})$. Denote total union as $O_n$, then $$\begin{align}\lambda(O_n)&=\sum_{k,j}(b_{k,j}-a_{k,j})\le\frac{1}{R}\sum_{k,j}(F(b_{k,j})-F(a_{k,j}))\\&\le\frac{1}{R}\sum_k(F(b_k)-F(a_k))\le\frac{r}{R}\sum_k(b_k-a_k)\\&\le\frac{r}{R}\lambda(I_n)\end{align}$$Notice that $O_n\supset E\cap I_n$. Hence $$\lambda(E)=\sum_n\lambda(E\cap I_n)\le\sum_n\lambda(O_n)\le\frac{r}{R}\sum_n\lambda(I_n)=\frac{r}{R}\lambda(O)<\lambda(E)$$which is contradiction.
	- **Lemma**: for $G$ real-valued and continuous, let $E$ be the set of points s.t. $$G(x+h)>G(x)\quad\text{for some }h=h_x>0$$then $E$, if non-empty, is open, hence can be written as $E=\bigcup(a_k,b_k)$. Further if $(a_k,b_k)$ is finite, then $G(a_k)=G(b_k)$ except for $a=a_k$, in which we only have $\le$.
	- **Intuition**: the fact that $D^+<\infty\ae$ is quite obvious since intuitively we should have $F(b)-F(a)\ge\gamma\cdot\lambda(\set{D^+>\gamma})$. Similar idea applies to $D^+\le D_-\ae$, since for $\lambda(E)>0$ we can pick an interval $E\subset I$ s.t. $\lambda(E)>(1-\varepsilon)\lambda(I)$ ([[Lebesgue Measure]]), then the inequalities $D^+>R>r>D_-$ naturally yields a contradiction. This ideas is formalized via the lemma, which uses a light-shadow metaphor to bound the measure of points whose forward difference is positive: ![[Pasted image 20250613201232.png]]
	- **Integral of derivative**: for $F$ increasing and continuous, $\int_a^bF'\le F(b)-F(a)$. This can not be optimized, e.g., consider Cantor function. [[Special Function Gallery]]
	  **Proof**: denote $G_n(x)=(F(x+1/n)-F(x))/(1/n)$. We have $G_n\to F'\ae$, and by Fatou's lemma ([[Lebesgue Integral]]) we have $$\int_a^bF'\le\liminf\int_a^b G_n$$the rest is some easy simplification.
	- **Counterexample**: when monotonicity is abandoned things can get rather complicated, e.t.Weierstrass' continuous nowhere differentiable function. [[Special Function Gallery]]
- **Differentiability of AC**: if $F$ is absolutely continuous on $[a,b]$, then $F'$ exists $\ae$, and if $F'=0\ae$ then $F$ is constant.
  **Proof**: AC functions are BV, hence differentiable $\ae$. Denote $E=\set{x:F'=0}$, and fix $\varepsilon>0$. For any $x\in E,\mu>0$ there exists $x\in(a_x,b_x)$ s.t. $|F(b_x)-F(a_x)|\le\varepsilon(b_x-a_x),b_x-a_x<\mu$. Now the collection $\set{(a_x,b_x)}$ forms a Vitali covering, hence by the lemma below there exists a finite sub-covering $I_i$ s.t. $\sum\lambda(I_i)\ge\lambda(E)-\delta$ for any $\delta>0$. Now by AC $$|F(b)-F(a)|\le\sum|F(b_i)-F(a_i)|+\sum|F(\beta_k)-F(\alpha_k)|\le\varepsilon(b-a)+\varepsilon$$where we're assuming that $\delta$ is chosen appropriately for $\varepsilon$. Hence $F(b)=F(a)$.
	- **Vitali covering**: for $E$ a collection of balls $\mathcal B$ is called a Vitali covering if for any $x\in E,\mu>0$ there exists $B\in\mathcal B$ s.t. $x\in B,\lambda(B)<\mu$. Given any $\delta>0$ we can find a finite sub-collection of disjoint balls $\set{B_i}$ of Vitali covering s.t. $$\sum_{i=1}^N\lambda(B_i)\ge\lambda(E)-\delta$$**Proof**: we utilize the Vitali's covering argument above. Given $\delta>0$ we pick a compact $E_1\subset E$ with $\lambda(E_1)>\delta$, and apply open covering principle and Vitali covering argument to obtain a sub-collection $\mathcal B_1$ with $\sum\lambda(B_i)\ge3^{-d}\delta$. Repeat the process for $E-\bigcup E_i$ until we get the desired sub-collection (which must stop at finite step, since $\lambda(E)<\infty$).
	- **Intuition**: it's known that indefinite integral is AC ([[Lebesgue Integral]]), and a deeper idea is that AC ensures a function to increase "reasonably" - it rules out the possibility that a function (like the Cantor function) having uncountably many discontinuities while still being continuous. 
	- **Integral of derivative**: given $F$ AC on $[a,b]$ we have that $\int_a^b F'=F(b)-F(a)$. Conversely if $f$ is integrable on $[a,b]$, there exists AC $F$ s.t. $F'=f\ae$ (by AC of [[Lebesgue Integral]]). This is the fundamental theorem of calculus under Lebesgue integral settings.
- **Differentiability of jump function**: for $F$ increasing and bounded on $[a,b]$ its discontinuities are at most countable, denoted $\set{x_n}$. Let $F(x_n)=F(x_n^-)+\theta_n\alpha_n$ where $\alpha_n=F(x_n^+)-F(x_n^-)$, then the jump function associated with $F$ is given by $$J_F(x)=\sum_{n=1}^\infty\alpha_nj_n(x)\quad\text{where}\quad j_n(x)=\begin{cases}\theta_n,&x=x_n\\H(x-x_n),&\text{otherwise}\end{cases}$$We have $F-J_F$ increasing and continuous, and $J_F'$ exists and vanishes $\ae$.
  **Proof**: since $\limsup\frac{J(x+h)-J(x)}{h}$ is measurable, the set $E$ consisting of points for which the difference is larger than $\varepsilon$ is measurable. Assume that $\lambda(E)=\delta>0$. Decompose $J_F=J_0+J_1$ for index $1\le n\le N$ and $n>N$, then by convergence of $\sum\alpha_n$ we can choose $N$ to make $J_1<\eta$. The set $E_1$ for $J$ replaced by $J_1$ differs from $E$ at finite points, hence we can find compact $K$ with $\lambda(K)\ge\delta/2$ s.t. $\limsup\frac{J_1(x+h)-J_1(x)}{h}$. Now for each $x$ we find an interval $(a_x,b_x)$ s.t. $x\in(a_x,b_x),J_1(b_x)-J_1(a_x)>\varepsilon(b_x-a_x)$. Apply open covering principle and Vitali covering argument, we find $\sum\lambda(I_j)\ge\lambda(K)/3$. Now $$J_1(b)-J_1(a)\ge\sum(J_1(b_j)-J_1(a_j))\ge\varepsilon(b_j-a_j)\ge\frac{\varepsilon}{3}\lambda(K)\ge\frac{\varepsilon\delta}{6}$$Since $J_1(b)-J_1(a)$ is bounded, we know that $\delta=0$.
	- **Lebesgue decomposition of increasing function**: for $F$ increasing we have $$F=F_A+F_S+F_J$$where three components are AC, singular, and jump functions. Notice its similarity with that in [[Signed Measure]].
	  **Proof**: take $F_J$ the jump function defined above, then $F-F_J$ is increasing and continuous, hence BV. Taking $F_A=\int_a^x(F-F_J)'$ and $F_S=F-F_J-F_A$ completes the proof. 