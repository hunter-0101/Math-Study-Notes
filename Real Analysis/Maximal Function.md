## Hardy-Littlewood maximal function
For $f$ (locally) integrable, its **Hardy-Littlewood maximal function** is defined as $$Mf(x)=\sup_{x\in B}\frac{1}{|B|}\int_B|f(t)|dt$$since the integral is jointly continuous in $x$ and $B$, we know that $Mf$, being a supremum, is a [[Measurable Function]].
- **Vitali covering argument**: suppose $B=\{B_n\}_{n=1}^N$ is a finite collection of open balls in $\mathbb R^d$, then there exists a disjoint sub-collection $B_{i_1},\cdots,B_{i_k}$ satisfying $$\lambda\left(\bigcup_{B_l\in B}B_l\right)\le3^d\sum_{j=1}^k\lambda(B_{i_j})$$**Proof**: in each iteration pick the largest possible ball, enlarge its radius to $3$ times, and throw away all balls intersecting with it.
	- This is a typical example of the [[Greedy Algorithm]].
- **Hardy-Littlewood theorem**: if $f\in L^1(\mathbb R^d)$, we have the weak-type inequality $$\lambda(\set{x\in\mathbb R^d:Mf(x)>\alpha})\le\frac{3^d}{\alpha}\|f\|_1,\quad\forall\alpha>0$$**Proof**: let $E_\alpha=\set{Mf(x)>\alpha}$. Each $x\in E_\alpha$ is associated with a ball $B_x$, hence $E_\alpha\subset\bigcup B_x$. For any compact $K\subset E_\alpha$ by covering lemma we find a finite covering $K\subset\bigcup_{i=1}^N B_i$, and apply Vitali's covering argument we further pick disjoint $B_{i_j}$. Now $$\begin{align}\lambda(K)&\le\lambda\left(\bigcup_{i=1}^mB_{i_j}\right)\le 3^d\sum_{j=1}^m\lambda(B_{i_j})\\&\le\frac{3^d}{\alpha}\sum_{j=1}^m\int_{B_{i_j}}|f(t)|dt\\&\le\frac{3^d}{\alpha}\|f\|_1\end{align}$$This holds for any compact $K\subset E_\alpha$, hence $E_\alpha$ itself by continuity of [[Lebesgue Measure]].
	- **Intuition**: noticing that $Mf$ is not integrable (e.g. $Mf(x)\ge\frac{c}{|x|^d}$ by considering $B(0,x)$ for some $c>0$), we step backward to bound the set on which $Mf$ is large. The weak type estimate above is optimal in the sense that given $f=\chi_B$ where $B$ is the unit ball, we have $\lambda(\set{x:Mf>\alpha})\ge c/\alpha$ for some $c>0$ and all $\alpha$ sufficiently small.
- **[[Lp Space]] inequality**: for $f\in L^p(\mathbb R^d)$ with $1<p\le\infty$ we have $Mf\in L^p(\mathbb R^d)$ with $$\|Mf\|_p\le A_p\|f\|_p$$**Proof**: consider $f=f_1+f_\infty$ where $f_1=f\chi_{\set{|f|>\alpha/2}}$, then $Mf\le Mf_1+Mf_\infty\le Mf_1+\alpha/2$, hence $\set{x:Mf(x)>\alpha}\subset\set{x:Mf_1>\alpha/2}$, and by the weak-type inequality on $f_1$ we get $$\lambda(\set{x:Mf>\alpha})\le\frac{A}{\alpha}\int_{|f|>\alpha/2}|f|dx,\quad\forall\alpha>0$$Meanwhile, for $g\ge0$ denote $F_{g}(\alpha)=\lambda(\set{x:g(x)>\alpha})$, then by Fubini's theorem we have $$\int_{\mathbb R^d}(g(x))^pdx=\int_0^\infty F_{g}(\alpha^{1/p})d\alpha$$Apply the identity on $F=Mf$ and utilize Chebyshev's inequality ([[Lp Space]]) we get $$\begin{align}\int_{\mathbb R^d}(Mf(x))^pdx&=\int_0^\infty F_{Mf}(\alpha^{1/p})d\alpha\\&\le A\int_0^\infty\alpha^{-1/p}\left(\int_{|f|>\alpha^{1/p}/2}|f|dx\right)d\alpha&\text{Chebyshev's inequality}\\&=A\int_{\mathbb R^d}|f(x)|\left(\int_0^{|2f(x)|^p}\alpha^{-1/p}d\alpha\right)dx&\text{Fubini's theorem}\\&=\frac{Ap2^{p-1}}{p-1}\int_{\mathbb R^d}|f(x)|^pdx&\text{Direct calculation}\\&=A_p^p\|f\|_p^p\end{align}$$where $A_p=\frac{Ap2^{p-1}}{p-1}$. This completes the proof.