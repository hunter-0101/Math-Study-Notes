- **Motivation**: [[Riemann Integral]] is "bad" in the following sense:
	- **Functions with pathological behavior**: for special functions like Dirichlet function or Cantor function, their Riemann integral cannot be defined.
	- **Bad behavior under limit**: sequence of integrable functions may converge to one that is not integrable. This basically boils downs to completeness below.
	- **Completeness of integrable function space**: the space $C([a,b])$ is not complete under $\langle f,g\rangle=\int^\mathcal Rfg$. This causes huge problems to study of PDE.
  Considering the completion of [[Metric Topology]] is not satisfying since it's abstract.
- **Advantage**
	- **Riemann integrability implies Lebesgue integrability**, and it can solve more problems than the former ([[Riemann Integral]]). Moreover, for a Riemann integrable function its Riemann integral and Lebesgue integral equals.
	- Modern probability theory is built on measure theory, thus rather than Riemann integral, Lebesgue integral provide better perspective to problems in [[Distribution Function]].
**Advantage over [[Riemann Integral]]**: at the heart of measure theoretic integral theory is a **shift in perspective**: instead of partitioning the domain we fix a level set value and ask how much domain is mapped to it. The superiority of Lebesgue integral over Riemann integral has its root in the asymmetry of definition of function ([[Set Theory]]): each element in its domain is associated to a specific value in image, which is clean and clear, while the image might exhibit pathological behavior (e.g., Dirichlet function).

- **Uniqueness**: Lebesgue integral defined below on $\mathbb R^d$ is the unique functional ([[Dual Space]]) on set of Lebesgue [[Measurable Function]] satisfying:
  1. **Translational invariance**: $\int f(x)dx=\int f(x+a)dx,\forall a$.
  2. **Scaling property**: $\int f(ax)dx=\frac{1}{a}\int f(x)dx$.
  3. **Truncation property**: for any $f$ we have $$\lim_{M\to\infty}\int\min(f,M)dx=\int f,\quad\lim_{M\to\infty}\int f\chi_{[-M,M]}=\int f$$
  4. **Normality**: $\int\chi_{[0,1]}=1$. 
  This is quite immediate: normality determines the integral for all step functions, hence all simple functions by regularity of [[Lebesgue Measure]], which allows us to generalize the result further to bounded, compactly supported functions. Then the truncation property completes the proof, since any function can be approximated by horizontal and vertical truncation.

---
## Lebesgue integral
We define the Lebesgue integral progressively from the simple function to the most general integrable functions.
- **Simple function**: for $\phi$ with canonical representation $\phi=\sum_{i=1}^n a_i\chi_{E_i}$, define $$\int\phi d\mu=\sum_{i=1}^na_i\mu(E_i)$$Note that the result is independent of the representation of simple function, proven by refining the domain of any representation into its basis.
	- **Properties**: this definition satisfies **linearity, additivity (w.r.t domain), monotonicity, triangle inequality**, etc..
- **Bounded finitely-supported function**: for $|f|<M$ with $\lambda(\supp f)<\infty$, define $$\int fd\mu=\lim_{n\to\infty}\int\phi_nd\mu\quad\text{where}\quad\phi_n\to f\ae\ [\mu]$$The convergence is guaranteed by Egorov's theorem. [[Measurable Function]]
	- **Relation with [[Riemann Integral]]**: using Darboux definition we can deduce that Riemann integrability $\Rightarrow$ Lebesgue integrability, and $\int_{[a,b]}^\mathcal Rf=\int_{[a,b]}^\mathcal Lf$.
- **Non-negative function**: for $f$ positive but not necessarily bounded/finitely-supported define $$\int fd\mu=\sup_g\int gd\mu\quad\text{where}\quad g\text{ measurable, bounded, finitely supported, and }0<g\le f$$when the supremum is finite we say that $f$ is **integrable**.
	- If $f\ge0$ is integrable, then $f<\infty\ae\ [\mu]$; if $\int f=0$ then $f=0\ae\ [\mu]$.
	  **Proof**: for the first assertion let $E_n=\set{f>n}$ and apply MCT of [[Lebesgue Measure]]; for the second let $E_n=\set{f>1/n}$ and also apply MCT of measure.
- **General function**: measurable $f$ is said to be integrable if $|f|$ is integrable in the above sense, and define $\int f=\int f^+-\int f^-$ where $f^+=\max(f,0),f^-=\max(-f,0)$.
	- **$\ae$ Convention**: since any change of a null set of $f$ does not influence $\int f$, we always neglect things like undefined-ness on null set or validity of $\int (f+g)$.
	- Equivalently, since $|f|=f_++f_-$, we know that $f$ is Lebesgue integrable if $\int_\mathbb R|f|d\mu<\infty$.
	- **Relation with improper [[Riemann Integral]]**: an improper Riemann integral is Lebesgue integrable iff it's absolutely convergent (by MCT). As a counterexample for $f(x)=x^2\sin(1/x^2)$ we have $f'$ exists for all $x\in\mathbb R$ and $\int_0^1 f'$ exists in the improper Riemann sense, but $f'$ is not Lebesgue integrable on $[0,1]$.
- **Complex functions**: we let $\int f=\int\Re f+i\int\Im f$.
## Basic theorems
Note that each of MCT, Fatou's lemma, and DCT can be proved independently from property of [[Measure]], or once we know one of them we can use it to proof the others.
- **Monotone convergence theorem (Beppo Levi's lemma)**: for measurable (not necessarily integrable) $f_n\ge0,f_j\le f_{j+1}$ for all $j$, and $f=\sup f_n$ is a pointwise supremum, then $$\int_X fd\mu=\int_X\sup f_nd\mu=\sup_n\int_X f_nd\mu$$**Proof**: $f$ is measurable since can be shown by $$f^{-1}([0,t])=\bigcap_nf_n^{-1}([0,t])$$We always have $\int_Xfd\mu\ge\sup\int_Xf_nd\mu$ because of the monotonicity of integral. We also have $\int_Xfd\mu\le\sup\int_Xf_nd\mu$ using simple function definition and an epsilon of room.
	- **Corollary**: given $a_n(x)\ge0$ measurable, we have $$\int\sum_{n\in\mathbb N}a_n(x)dx=\sum_{n\in\mathbb N}\int a_n(x)dx$$and if RHS is finite then the series $\sum a_n(x)$ converges $\ae$.
	- **Proof of Borel-Cantelli lemma**: take $a_n=\chi_{E_n}$ then the lemma follows.
	- **Arbitrarily small error**: given $f$ integrable, for any $\varepsilon>0$ by MCT there exists $B=B_N(0)$ s.t. $\int_{B^C}|f|<\varepsilon$, and also exists $\delta>0$ s.t. $\int_E|f|<\varepsilon,\forall \lambda(E)<\delta$.
	- **Pointwise convergence to non-integrable function**: given $f_n\nearrow f$ with $\int f=\infty$ we have $\lim f_n=\infty$.
- **Fatou's lemma**: if $f_n\ge0$ is any sequence, then $$\int_X(\liminf_n f_n)d\mu\le\liminf_n\int_X f_nd\mu$$**Proof**: define $g_n(x)=\inf_{k\ge n}f_k(x)$, then $\set{g_n(x)}$ is non-decreasing and $g_n\le f_n$. Since $$f(x) =\liminf_{n\to\infty} f_n(x) = \lim_n \inf_{k\ge n} f_k(x) = \lim_n g_n(x)$$we see that $f$ is measurable, thus integrable. By the MCT we have $$\int_X fd\mu= \int_X \lim_n g_nd\mu=\lim_n \int_X g_nd\mu=\liminf_{n\to \infty}\int_X g_nd\mu\leq \liminf_{n\to \infty}\int_X f_nd\mu$$which complete the proof.
	- **Reverse Fatou's lemma**: using the same notation, if there is a non-negative integrable $g$ such that $f_n\le g$, then we have $$\limsup_{n\to\infty}\int_Xf_nd\mu\le\int_X\limsup_{n\to\infty}f_nd\mu$$This can be proven by applying the Fatou's lemma to $g-f_n$. Since $\int_Xgd\mu\le\infty$, the sequence is defined $\mu$-almost everywhere and non-negative.
	- **Intuition**: integral is a "global" property in the sense that it averages over the integral domain and hides some local outliers, while $\liminf$ is "local" that selects the overall infimum at each point. This is similar to the difference between $\ae$ convergence and $\mu$-convergence ([[Measurable Function]]). $f_n=\chi_{[n,n+1]}$ is an obvious example for which the equality doesn't hold. $f_n=-\chi_{[n,n+1]}$ is another example of negative function for which the inequality is even reversed. 
	- **$\mu$-convergence version**: the condition can be weakened to $\mu$-convergence, and the proof also uses the subsequence principle as below. 
- **Dominated convergence theorem**: $f_n\to f\ae$ and $|f_n|\le g,\forall n$ given some $g\in L^1$ then $$\lim_{n\to\infty}\int_\mathbb Rf_nd\mu=\int_\mathbb R\lim_{n\to\infty}f_nd\mu=\int_\mathbb Rfd\mu$$**Proof**: let $E_N=\set{x:|x|\le N,g(x)\le N}$. By corollary of MCT for any $\varepsilon>0$ there exists $N$ s.t. $\int_{E_N^C}g<\varepsilon$. For $f_n\chi_{E_N}$ bounded and finitely supported with some estimation we have that $$\int_{E_N}|f_n-f|<\varepsilon,\quad\forall n\text{ large}$$hence for all large $n$ we have $$\int|f_n-f|=\left(\int_{E_N}+\int_{E_N^C}\right)|f_n-f|\le\int_{E_N}|f_n-f|+2\int_{E_N^C}g\le3\varepsilon$$which is actually stronger than the desired result.
	- **$\mu$-convergence**: by [[Measurable Function]], given $f_n\xto\mu f$ for any of its sub-sequence $\set{f_{n(i)}}\subset \set{f_n},f_{n(i)}\xto\mu f$ we can further pick $\set{f_{n(i,j)}}\subset\set{f_{n(i)}},f_{n(i,j)}\to f\ae$. Now DCT can be applied, and by arbitrary-ness of $f_{n(i)}$ DCT can be generalized, via the idea of [[Subsequence Acceleration]] in the topology induced by $L^1$ norm.
		- **Proof via direct estimation**: we can also pick a subsequence $f_{n(i)}\to f\ae$ and apply DCT, and then prove via estimation that $\int f_n\to\int f$. This method, although more natural and intuitive, does worse in illustrating the topological nature of convergence.
	- **Intuition**: $\ae$ (or $\mu$-) convergence would intuitively give rise to convergence of integral, but $f_n=\chi_{[n,n+1]}$ shows that without domination there are some middle spaces in which local behavior (limit) can be hidden by global appearance (integral). In contrast, presence of dominating function erases such middle space, ensuring that the overall sequence is "within good control".
	- **Strengthen under stronger condition**: assume that $f_n\ge0,f_n\to f$ with $\|f_n\|=\|f\|,\forall n$, then it can be shown that $\int f_n\to\int f$. See [[Random Variable#Convergence of RV]].
- **Fubini's theorem**: if $f$ is integrable over $\mathbb R^{d_1}\times\mathbb R^{d_2}$, then for almost all $y\in\mathbb R^{d_2}$ the slice $f|_y$ is integrable on $\mathbb R^{d_1}$, with $\int_{\mathbb R^{d_1}}f|_y$ is integrable on $\mathbb R^{d_2}$, and moreover we have $$\int_{\mathbb R^{d_2}}\left(\int_{\mathbb R^{d_1}}f(x,y)dx\right)dy=\int_{\mathbb R^d}f$$**Proof**: denote $\mathcal F$ the set of functions satisfying all three conditions above, we'll show that $L^1(\mathbb R^d)\subset\mathcal F$ step by step.
  1. **$\mathcal F$ is closed under linear combination**: obvious by linearity of integral and additivity of measure.
  2. **$\mathcal F$ is closed under monotonic limit**: WLOG assume $f_n\nearrow f$ and $f_n\ge0$. By MCT we have $\int f_n\to\int f$. Since each $f_n|_y$ is integrable by assumption, by MCT for $\ae\ y$ we have $$g_n(y)=\int f_n|_y\quad\nearrow\quad g(y)=\int f|_y$$and each $g_n$ is also integrable by assumption. Again by MCT we have $\int g_n\to\int g$, and since $\int g_n=\int f_n$ by assumption, we finally get $\int g=\int f<\infty$. This means $g(y)$ is integrable, hence $g(y)<\infty\ae\ y$, hence $f|_y$ is integrable for $\ae\ y$. This proves $f\in\mathcal F$.
  3. **$\chi_{G_\delta}$ of finite measure**: the result is obvious for bounded cubes. For a finite union of almost-disjoint closed cubes apply 1 to the boundary and interior of each cube, and taking limit yields the result for open sets. In general for $G_\delta$ set $E$ we can find a series $O_n\searrow E$, and apply 2.
  4. **Null set**: for $\lambda(E)=0$ it's obvious that all results hold and the integral equals $0$.
  5. $\lambda(E)<\infty$: since any measurable set differs from a $G_\delta$ set by a null set, apply 1.
  6. **General case**: take $f=f^+-f^-$ and approximate them with simple functions.
	  - **Tonelli's theorem**: for non-negative functions all **integrable** is replaced by **measurable**, and equality still holds in the extended sense. The proof is already encapsulated in step 1~5.
	  - **Slice of measurable set**: given measurable $E$, apply the above theorem to $\chi_E$ we know that for $\ae\ y$ the slice $E|_y$ is also measurable, with its measure $\lambda(E)=\int\lambda(E|_y)$.
	  - For $f\ge0$ let $A=\set{(x,y)\in\mathbb R^d\times\mathbb R^d:0\le y\le f(x)}$, then $f$ measurable iff $A$ measurable, and in this case $\int f=\lambda(A)$.
- **Change of variable**: for $F$ increasing AC on $[a,b]$ with $F(a)=A,F(b)=B$, and $f$ measurable on $[A,B]$ we have $f(F(x))F'(x)$ measurable on $[a,b]$, and $$\int_A^Bf(y)dy=\int_a^bf(F(x))F'(x)dx$$**Proof**: since for all $a>0$ we have $$\set{f(F(x))F'(x)>a}=\bigcup_{r_n\in\mathbb Q^+}\set{(f\circ F>r_n)\land(F'>a/r_n)}$$similar formula can be obtained for $a\le 0$, hence $f(F)F'$ is measurable. For simple function $f$ we need to prove $\lambda(E)=\int_{F^{-1}(E)}F'$, which is true since $F$ is AC ([[Lebesgue Differentiability]]) and measurable sets can be approximated by $G_\delta$ set ([[Lebesgue Measure]]). Now we can now apply DCT to verify the formula for any $f$.
	- **Measurability of $\set{f\circ F>r}\cap\set{F'>s}$**: two steps are needed to complete the proof:
	  1. **For $\lambda(E)=0$ we have $\lambda(F^{-1}(E)\cap\set{F'>0})=0$**: we've already established the validity of $\lambda(E)=\int_EF'$ for measurable $E$, hence $$0=\lambda(E)=\int_{F^{-1}(E)}F'=\int_{F^{-1}(E)\cap\set{F'>0}}F'$$implying that the integral domain is of measure zero.
	  2. **For measurable $E$ we have $F^{-1}(E)\cap\set{F'>0}$ measurable**: take $G_n\searrow E'\supset E$ with $\lambda(E'-E)=0$, then apply DCT of measure. [[Lebesgue Measure]]
	   For general $s$ since $\set{F'>s}$ is open we establish the measurability.
	- **Remark**: note that $f\circ F$ need to to be measurable, say in [[Measurable Function#Real-valued function]]. Even strict monotonicity is not enough, say we take $\mathcal C$ a Cantor-like set of positive measure, $K=\mathcal C^C$, and let $F=\int_0^x\chi_K$. In the above proof we go around the problem by intersection with $\set{F'>0}$ in the first case and then generalize it.
	- **General case**: for bijective $\Phi\in C^1(\mathbb R^d)$ and any $E$ we can partition $E$ into disjoint cubes $Q_n$ that are small enough, and consider $$\Phi(x)=\Phi(x_n)+\Phi'(x_n)(x-x_n)+o(\varepsilon),\quad\forall x\in Q_n$$then as $\varepsilon\to0$ we'll have $$\lambda(\Phi(E))=\sum_n\lambda(\Phi(Q_n))=\sum_n|\det\Phi'(x_n)|\lambda(Q_n)+o(1)\to\int_E|\det\Phi'|d\lambda$$This is exactly the case for $\chi_E$, and we can easily generalize it to $$\int_{\Phi(E)}f=\int_Ef\circ\Phi\cdot|\det\Phi'|$$
- **Integration by parts**: if $F,G$ are AC then $$\int_{[a,b]}FdG+\int_{[a,b]}GdF=F(b)G(b)-F(a)G(a)$$We only need to verify that $FG$ is AC, and the rest follows from [[Differential Calculus on Euclidean Space]].
- **Other properties**
	- Essentially bounded function is Lebesgue integrable, but not the inverse, like $\int_{(0,1)}\frac{dx}{\sqrt x}$.
	- **Additivity w.r.t domain**: by MCT we have $$\int_{\bigcup E_n}f=\sum_n\int_{E_n}f\quad\text{where}\quad E_i\cap E_j=\varnothing,\forall i\neq j$$This can be seen as another form of changing order of sum and integral.
	- **Absolute continuity**: for $f$ integrable given any $\varepsilon>0$ there exists $\delta>0$ s.t. $$\int_Ef<\varepsilon,\quad\forall \lambda(E)<\delta$$**Proof**: denote $f_n=f\chi_{E_n}$ where $E_n=\set{f\le n}$. Since $f_n\nearrow f$ by MCT there exists $N$ s.t. $\int(f-f_N)<\varepsilon$, while $\int_E f_N$ can also be bounded given $\lambda(E)\le\varepsilon/N$. Combining them yields the result. This provide a solid framework for integral smoothing. [[Functional Approximation]]
	- **Identity theorem of locally integrable functions**: given $f\in L_\text{loc}^1(\Omega)$ for open $\Omega\subset\mathbb R^n$, if $$\int_E f=0,\quad\forall E\in\mathcal L$$then $f=0\ae$ on $\Omega$.
	  **Proof**: just consider two sets $$A=\set{f>0},\quad B=\set{f<0}$$If otherwise the result is false, then at least one of them are of positive measure, which we assume to be $A$. Since $(0,\infty)\in\mathcal B(\mathbb R)$ and $f$ is measurable, we have $A\in\mathcal L$ by definition of [[Measurable Function]], hence $\int_Af>0$, a contradiction.
		- **Weaker condition**: given $\mathcal F$ a family of measurable sets on $\mathbb R^n$, if $\mathcal F$ is a $\pi$-system ([[Set Theory]]), $\sigma(\mathcal F)=\mathcal B(\mathbb R^n)$, and $\int_Ef=0,\forall E\in\mathcal F$, then $f=0\ae$.
		  **Proof**: define the collection $$\mathcal A=\Set{E\in\mathcal B:\int_Ef=0}$$ we can verify directly that $\mathcal A$ contains $\mathbb R^n$, and is closed under complements and disjoint union, hence $\mathcal A$ is a $\lambda$-system. By $\pi$-$\lambda$ theorem this implies $$\mathcal B=\sigma(\mathcal F)\subset\mathcal A\quad\Longrightarrow\quad\mathcal A=\mathcal B$$hence we can conclude with the above result that $f=0\ae$.
		- **Characterization of periodic function**: a function is said to be periodic (almost everywhere) if it can be made periodic in the classical sense by adjusting values over a null set. We have that, a function is periodic with period $T$ iff $$\int_a^{a+T}f(x)dx=\text{const},\quad\forall a\in\mathbb R$$This follows directly from the identity theorem, applied on $g(x)=f(x+T)-f(x)$.