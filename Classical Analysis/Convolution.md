**Motivation**: in many cases we would like to investigate a blackbox that takes in an input and returns an output, which also satisfies the following properties:
1. **Translational invariance**: if $f(t)\mapsto g(t)$, then $f(t-a)\mapsto g(t-a)$.
2. **Linearity**: if $f_1(t)\mapsto g_1(t),f_2(t)\mapsto g_2(t)$, then $(\alpha f_1(t)+\beta f_2(t))\mapsto (\alpha g_1(t)+\beta g_2(t))$.
3. **Continuity**: a small alteration of input generates  small changes in the output.
4. **Casualty**: output of $g(t_0)$ is not affected by $f(t),\forall t>t_0$.
We may assume by 2, 4 that $\vec\delta_i=(0,\cdots,0,1,0,\cdots)\mapsto\vec a_k(0,\cdots,0,a_0,a_1,\cdots)$, then since the input $$\vec f=(f_1,f_2,\cdots,f_n,0)=\sum_{k=0}^n f_k\delta_k\quad\longmapsto\quad\vec g=\sum_{k=0}^n f_k\vec a_k=(f_0a_0,f_0a_1+f_1a_0,\cdots,\sum_{j=0}^nf_ja_{n-j},0,\cdots)$$for simplicity we define the above expression as $\vec g=\vec f*\vec a$. If we look at the more general case that $\vec f=(f_k)_{-\infty}^\infty$, then the expression generalize to $(f*a)_t=\sum_{k=-\infty}^\infty f_ka_{t-k}$. Using a similar reasoning process we can generalize the above result to continuous time domain as $$g(t)=f*\varphi(t)=\int_\mathbb R f(u)\varphi(t-u)du$$This can of course be generalized to $\mathbb R^d$.
---
The **convolution** of $f,g$ is defined as $$(f*g)(x)=\int_\mathbb R f(t)g(x-t)dt=\int_\mathbb Rf(x-t)g(t)dt$$A more general definition in $\mathbb R^d$ is $$(f*g)(x)=\int_{\mathbb R^d}f(y)g(x-y)dy=\int_{\mathbb R^d}f(x-y)g(y)dy$$Note that convolution is actually a "reversed" cross-correlation, differing on whether or not one of the functions is reflected about the $y$-axis. [[Expectation]]
- **Domain of definition**: convolution as an operator can be defined on several different spaces:
	- **Compactly supported functions**: for $f,g$ compactly supported, $f*g$ is compactly supported and continuous, since compactly supported function is uniformly continuous.
	- **$L^p$ functions**: we have $L^1(\mathbb R^d)*L^1(\mathbb R^d)\subset L^1(\mathbb R^d)$, as a consequence of Fubini's theorem ([[Lebesgue Integral]]), hence $f*g$ is well-defined for $\ae t$. 
		- **General domain of definition**: Young's inequality ([[Lp Space]]) implies that convolution is a continuous bilinear map $*:L^p\times L^q\to L^r$ satisfying $\frac{1}{p}+\frac{1}{q}=\frac{1}{r}+1$.
- **Continuity**: In general convolution preserves continuity to the highest level. Intuitively this is due to the smoothing property of integral, such as absolute continuity ([[Lebesgue Integral]])
## Property
- **Commutativity**: $f*g=g*f$ by change of variable. 
- **Associativity**: $f*(g*h)=(f*g)*h$ by Fubini's theorem [[Lebesgue Integral]].
- **Distributive**: $f*(g+h)=f*g+f*h$ by linearity of [[Lebesgue Integral]].
- **Differentiation**: given any multi-index $\alpha$ we have $$\frac{\partial^\alpha}{\partial x^\alpha}(f*g)=\frac{\partial^\alpha f}{\partial x^\alpha}*g=f*\frac{\partial^\alpha g}{\partial x^\alpha}$$**Proof**: the result for $d/dx$ follows from [[Differentiation Under the Integral Sign]], and can be extended to the general under some mild constraints on smoothness via Schwartz's theorem in [[Differential Calculus on Euclidean Space]], which is quite common in practical applications.
- **Laplace transform of convolution**: $\tilde f(s)\cdot \tilde g(s)=\int_{-\infty}^\infty e^{-st}(f*g)(t)dt=\mathcal L\set{f*g}$. See [[Laplace Transform]] for detailed description.
- **Fourier series of convolution**: for $f,g:\mathbb T\to\mathbb R$ we have $\widehat{(f*g)}=\hat f\cdot\hat g$ where convolution is defined on the unit circle $\mathbb T$.
- For $f\in L^p,k\in L^1$ we have $\|f*k\|_p\le\|f\|_p\cdot\|k\|_1$.
  **Proof**: denote $q$ the conjugate of $p$, then $$\begin{align}\|f*k\|_p^p&=\int\left|\int f(x-u)k(u)du\right|^pdx\\&\le\int\left(\int|f(x-u)||k(u)|^{1/p}|k(u)|^{1/q}du\right)^pdx\\&\le\int\left(\|f(x-u)k(u)^{1/p}\|_p\|k(u)^{1/q}\|_q\right)^pdx\\&=\|k\|_1^{p/q}\|f^p*k\|_1\\&\le\|k\|_1^{p/1}\|k\|_1\|f^p\|_1\\&=\|k\|_1^p\|f\|_p^p\end{align}$$where we used HÃ¶lder's inequality and Tonelli's theorem. A more general result is Young's convolution inequality ([[Lp Space]]).
- **Fixed point of auto-convolution**: the only solution to $f*f=f$ is $f=\sum a_n\delta_n$ where $\delta_n$ is some translation of $\delta$ ([[Special Function Gallery]]). However if we allow for $f*f= af(bx)$ then Gaussian distribution is also a solution.
## Approximate identity
### Summability kernel
This kernel is mainly applied in [[Fourier Series]].
A family of summability kernels is a sequence of functions $\{K_n(x)\}$ that satisfies the following properties:
1. For all $n\ge1$, we have $\frac{1}{2\pi}\int_{-\pi}^\pi K_n(x)=1$.
2. There exists $M>0$ such that for all $n\ge1$, we have $\int_{-\pi}^\pi|K_n(x)|dx\le M$.
3. For every $\delta>0$, we have $\int_{\delta\le|x|\le\pi}|K_n(x)|dx\to0$ as $n\to\infty$.
It can be shown that the "limit kernel" is actually a multiplier of Dirac delta function ([[Special Function Gallery]]),as show in the following property
- **Approximation to the identity**: for a family of summability kernels $K_n$, whenever $f$ integrable and is continuous at $x$ we have $$\lim_{n\to\infty}(f*K_n)(x)=f(x)$$where $*$ is the periodic convolution defined by $(f*g)(x)=\frac{1}{2\pi}\int_{-\pi}^\pi f(t)g(x-t)dt$.
	- **Proof**: by continuity, for any $\varepsilon>0$ there exists $\delta>0$ such that $|f(x+t)-f(x)|<\varepsilon$ if $|t|<\delta$. Assume that $f$ is bounded by $B$. By definitions of good kernels, we have $$\begin{align}|(f*K)(x)-f(x)|&=\left|\frac{1}{2\pi}\int_{-\pi}^\pi K_n(t)[f(x-t)-f(x)]dt\right|\\&\le\frac{1}{2\pi}\left(\int_{|t|<\delta}+\int_{\delta\le|t|\le\pi}\right)|K_n(t)||f(x-t)-f(x)|dt\\&\le\frac{\varepsilon}{2\pi}\int_{-\pi}^\pi|K_n(t)|dt+\frac{2B}{2\pi}\int_{\delta\le|t|\le\pi}|K_n(t)|dt\\&\le\frac{\varepsilon M+2B\epsilon}{2\pi}\end{align}$$where $\epsilon$ is obtained by the third property. This completes the proof. 
### Good kernel
A family of good kernels is a sequence of functions $\set{K_\delta(x)}$ that satisfies
1. **Normalized**: $\int K_\delta=1$.
2. **$L^1$-boundedness**: $\sup\|K_\delta\|_1<\infty$.
3. **Concentration**: $\int_{|x|\ge\eta}|K_\delta|\to0$ as $\delta\to0$ for fixed $\eta>0$.
The main use is that when $f$ is bounded, we have $f*K_\delta\to f$ at every **point of continuity** of $f$: $$\begin{align}|f*K_\delta(x)-f(x)|&=\left|\left(\int_{|t|<\eta}+\int_{|t|\ge\eta}\right)(f(x-t)-f(x))K_\delta(t)dt\right|\\&\le\varepsilon\int_{|t|<\eta}K_\delta+2\sup|f|\int_{|t|\ge\eta}K_\delta\to0,\quad\delta\to0\end{align}$$Another useful result is **$L^1$ convergence**: given $f\in L^1$ we have $$\begin{align}\|f*K_\delta-f\|_1&=\int\left(\int(f(x-t)-f(x))K_\delta(t)dt\right)dx\\&\le\int\left(\int|f(x-t)-f(x)|\cdot|K_\delta(t)|dt\right)dx&\text{Triangle inequality}\\&=\iint|f(x-t)-f(x)|\cdot|K_\delta(t)|dxdt&\text{Tonelli's theorem}\\&=\int\|f-f_t\|_1|K_\delta(t)|dt\\&=\left(\int_{|t|<\eta}+\int_{|t|\ge\eta}\right)\|f-f_t\|_1|K_\delta(t)|dt\to0\end{align}$$where the last line follows from AC of [[Lebesgue Integral]] and concentration property.
- **Stronger version**: to include all points of Lebesgue set we need to strengthen the two. We replace 2, 3 with the following two conditions:
  2. $|K_\delta(x)|\le A\delta^{-d},\forall \delta>0$.
  3. $|K_\delta(x)|\le A\delta/|x|^{d+1},\forall\delta>0,x\in\mathbb R^d$.	
  Obviously the conditions are stronger, and now we have that $$f*K_\delta\xto{\ae} f,\quad\forall f\in L^1(\mathbb R^d)$$**Proof**: as a preliminary, given $x$ a Lebesgue point of $f$ consider the integral $$A(r)=\frac{1}{r^d}\int_{|t|\le r}|f(x-t)-f(x)|dt,\quad r>0$$By AC of [[Lebesgue Integral]] we have $A(r)$ continuous, and $A(r)\to0,r\to0$ by [[Lebesgue Differentiability]] theorem. Further $A(r)$ is bounded by a simple estimation. Now to estimate $\int|f(x-y)-f(x)|\cdot|K_\delta(y)|dy$ we consider the **dyadic decomposition** $$\int_\mathbb {R^d}=\int_{|y|\le\delta}+\sum_{k=0}^\infty\int_{2^k\delta<|y|\le2^{k+1}\delta}$$By property 2 the first term can be directly bounded by $cA(\delta)$, and for the rest terms $$\begin{align}\int_{2^k\delta<|y|\le2^{k+1}\delta}|f(x-y)-f(x)||K_\delta(y)|dy&\le\frac{c\delta}{(2^k\delta)^{d+1}}\int_{|y|\le2^{k+1}\delta}|f(x-y)-f(x)|dy\\&=\frac{c\delta}{2^{k-d}\delta(2^{k+1}\delta)^d}\int_{|y|\le2^{k+1}\delta}|f(x-y)-f(x)|dy\\&\le\frac{c'}{2^k}A(2^{k+1}\delta)\end{align}$$where $c'$ depends only on $d$. Hence we have $$|f*K_\delta-f|\le cA(\delta)+c'\sum_{k=0}^\infty2^{-k}A(2^{k+1}\delta)$$given $\varepsilon>0$ we choose $N$ s.t.  $\sum_{k\ge N}2^{-k}<\varepsilon$, and by making $\delta$ small we have $A(2^k\delta)<\varepsilon/N$. Now the above bound is less than $C\varepsilon\to0$.
	- **Intuition on conditions**: two modified conditions are essentially saying that, $|K_\delta|$ is dominated by a decreasing function $A\delta/|x|^{d+1}$ while its allowed maximal value is getting higher and higher. These two conditions ensures that more mass is accumulating around $0$ in a more accurate fashion. This is often good for actually application since most $\set{K_\delta}$ are define in the form $K_\delta(x)=\delta^{-1}K_1(\delta^{-1}x)$.
	- **Uniform convergence**: the upper bound for $|f*K_\delta-f|$ in the proof is uniform. That is, approximation to the identity converges uniformly on the set of Lebesgue points.
	- **$L^p$ convergence**: since Lebesgue points are dense ([[Lebesgue Differentiability]]) and the convergence is uniform, norm convergence can be established first on functions of compact support, and then generalize to [[Lp Space]] via simple estimation. 
		- **Alternative proof for special case**: given $K_\delta=\delta^{-d}K_1(\delta^{-1}x)$ we can also invoke the Minkowski's inequality for integral ([[Lp Space#Inequalities]]) to show that $$\|f*\Delta_\delta\|_p=\left\|\int(f(x-\delta y)-f(x))K_1(y)dy\right\|_p\le\int\|f(x-\delta y)-f(x)\|_p|K_1(y)|dy\to0$$by continuity of $L^p$ norm [[Lp Space]].
	- **Generalization**: the only place in the proof we used the fact $\int K_\delta=1$ is to introduce the $f$ term into the integral in $f*K_\delta$. Hence if we let $\int K_\delta=r,r\in\mathbb R$ then the result also changes to $f*K_\delta\to rf$.
	- **Relation with Hardy-Littlewood [[Maximal Function]]**: we can think of H-L function as $Mf=\sup f*\chi_B$ where $B$ is any ball containing $x$. Taking idea from [[Lebesgue Integral]] it makes sense to approximate each $K_\delta$ with $\chi_B$, which yields $$\sup_{\delta>0}|f*K_\delta|\le Mf,\quad\forall f\in L^1$$here the constant before $Mf$ is actually $\|K_\delta\|_1$. 
- **Special case**: in most cases the kernel is define via $K_\delta(x)=\delta^{-d}K(\delta^{-1}x)$ given some $K(x)$. In this case the conditions for the stronger version is equivalent to $$|K(x)|\le \min\left(A,\frac{A'}{|x|^{d+1}}\right),\quad\forall x\in\mathbb R^d,A,A'>0$$This is satisfied in most practical cases.
## Other kernels
### Gaussian kernel
Consider the Gaussian function $f(x)=e^{-x^2}$, or the more general parametric extension$$f(x)=a\exp\left(-\frac{(x-b)^2}{2c^2}\right)$$
- **Gaussian integral**: we have $$\int_{-\infty}^\infty ae^{-(x-b)^2/2c^2}=a|c|\sqrt{2\pi},\quad\int_{-\infty}^\infty e^{-x^2}=\sqrt\pi$$
	- **Proof 1: Polar coordinate**: consider $\int f(x)\int f(y)$ and make use of the double integral and change of variable, then the result can be easily obtained.
	- **Proof 2: differentiation under the integral sign**: let $A(t)=(\int_0^tf(x)dx)^2$, then what we want is $\sqrt{A(\infty)}$. Consider $\frac{d}{dt}A(t)$ and let $x=ty$ (which actually yields an "integrating factor", as we've done in [[Differentiation Under the Integral Sign]]), then the resulting expression can be easily anti-differentiated, thus the result can be obtained.
	- **Proof 3: volume integral**: view $(f(x),f(y))$ as a surface $S$, then $\int f(x)\int f(y)$ is actually the volume under the surface. The result, on one hand, is the Riemann integral; on the other hand, when calculating using Lebesgue integral we can easily obtain $\pi$, thus the result is $\sqrt\pi$. [[Lebesgue Integral]]
- **Gaussian kernel**: consider $$f_\varepsilon(x)=\varepsilon^{-1}f(\varepsilon^{-1}x),\quad\varepsilon>0$$then as $\varepsilon\to0$ we also have the approximation of identity property for this kernel.
### Poisson kernel
The Poisson kernel on $\mathbb D$ is given by ([[Cauchy Integral]]) $$P_r(\theta)=\sum_{n\in\mathbb Z}r^{|n|}e^{in\theta}=\frac{1-r^2}{1-2r\cos\theta+r^2}=\Re\frac{1+re^{i\theta}}{1-re^{i\theta}},\quad 0\le r<1$$Since $f\circ\phi$ where $f$ harmonic and $\phi$ holomorphic is still harmonic, by Cayley transform ([[Riemann Sphere]]) $\phi:\mathbb D\to\mathbb R_+^2,z\mapsto(z+i)/(iz+1)$ given any $f\in\mathcal O(\mathbb D)$ we have for $x+iy\in\mathbb R_+^2$ that $$\begin{align}f\circ\phi^{-1}(x+iy)&=\frac{1}{2\pi}\int_\mathbb R(f\circ\phi^{-1})(t)(P\circ\phi^{-1})(x+iy)\frac{d\left(\frac{t-i}{-it+1}\right)}{i\frac{t-i}{-it+1}}\\&=\frac{1}{2\pi}\int_\mathbb R(f\circ\phi^{-1})(t)\frac{1-|\phi^{-1}(x+iy)|^2}{1-\phi^{-1}(x+iy+\overline{x+iy})+|\phi^{-1}(x+iy)|^2}\frac{2dt}{1+t^2}\\&=\frac{1}{2\pi}\int_\mathbb R(f\circ\phi^{-1})(t)\frac{|1-ix|^2\cdot y}{(x-t)^2+y^2}\frac{2dt}{1+t^2}\\&=\frac{1}{\pi}\int_\mathbb R(f\circ\phi^{-1})(t)\frac{y}{(x-t)^2+y^2}dt\end{align}$$Hence we get the Poisson integral formula on $\mathbb R_+^2$ as $$f(x+iy)=\frac{1}{\pi}\int_\mathbb R f(t)P_y(x-t)dt=f(x)*P_y(x),\quad P_y(x)=\frac{1}{\pi}\frac{y}{x^2+y^2}$$Here $P_y(x)$ is referred to as the Poisson kernel on $\mathbb R_+^2$.
- **Poisson kernel in $\mathbb R^d$**: see [[Harmonic function]].
- **Fourier transform**: we have that $$\int_\mathbb Re^{-2\pi|\xi|y}e^{2\pi i\xi x}d\xi=\frac{1}{\pi}\frac{y}{x^2+y^2}=P_y(x)$$Hence by [[FT on L2]] we have $\mathcal F(P_y(x))=e^{-2\pi|\xi|y}$.
- **Conjugate Poisson kernel**: given $P_y$ above we define the conjugate Poisson kernel as $$Q_y(x)=\frac{1}{\pi}\frac{x}{x^2+y^2}$$it gets its name from the fact that $$-\frac{1}{i\pi z}=P_y(x)+iQ_y(x)$$It's easy to get that $\mathcal F(Q_y(x))=e^{2\pi|\xi|y}\frac{\sgn\xi}{i}$.
	- **Deduction of FT**: by [[Convolution]] theorem we have $$\int_0^\infty\hat f(\xi)e^{2\pi i\xi z}d\xi=\frac{1}{2\pi i}\int_\mathbb R\frac{f(\zeta)}{\zeta-z}d\zeta=\frac{1}{2}[(f*\mathcal P_y)(x)+(f*\mathcal Q_y)(x)]$$by the fact that $\mathcal F(\varphi^\sim)=\mathcal F(\varphi)^\sim$ where $\phi^\sim(x)=\phi(-x)$ ([[FT on L2]]) we get two equations, and by solving $f*\mathcal P_y,f*\mathcal Q_y$ we get $$(f* Q_y)(x)=\int_\mathbb R\hat f(\xi)e^{2\pi i\xi x}e^{-2\pi|\xi|y}\frac{\sgn\xi}{i}d\xi$$hence the result follows from uniqueness of [[FT on L2]].